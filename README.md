# HS 품목분류 챗봇 🚀

HS 품목분류 전문가 AI 챗봇입니다. 관세청 품목분류 사례, 해외 HS 분류 사례, HS 해설서 등 다양한 데이터를 Multi Agents 시스템으로 분석하여 전문적인 HS 코드 분류 답변을 제공합니다.

## 📋 목차
- [핵심 기능](#핵심-기능)
- [설치 및 실행](#설치-및-실행)
- [기능별 사용법](#기능별-사용법)
- [프로젝트 구조](#프로젝트-구조)
- [환경 설정](#환경-설정)

## 🎯 핵심 기능

### 1. **AI 자동분류** 🤖
- 사용자 질문을 LLM이 자동으로 분석하여 가장 적합한 방식으로 답변
- 5가지 질문 유형 중 최적의 방법을 자동 선택

### 2. **웹 검색** 🌐
- 물품개요, 용도, 뉴스, 무역동향, 산업동향 등 최신 정보 제공
- Google Search API를 통한 실시간 정보 검색

### 3. **국내 HS 분류사례 검색** 🇰🇷
- 관세청 품목분류 사례 약 1,000개 데이터베이스 분석
- **Multi Agents 시스템**: 데이터를 5개 그룹으로 분할하여 각 그룹별로 유사한 3개 사례 검색
- Head Agent가 최종 취합하여 전문적인 HS 코드 분류 답변 제공

### 4. **해외 HS 분류사례 검색** 🌍
- 미국 및 EU 관세청 품목분류 사례 분석
- **Multi Agents 시스템**: 해외 데이터를 5개 그룹으로 분할 분석
- 국제적인 HS 분류 동향 및 비교 분석 제공

### 5. **HS 해설서 분석 (병렬 검색)** 📚
- **혁신적 병렬 검색 시스템**: 관세율표와 HS 해설서를 동시에 활용
- **2단계 검색**: 관세율표에서 유사도 높은 HS코드 후보 선정 → 해설서 상세 분석
- **가중치 기반 점수**: 관세율표(40%) + 해설서(60%) 종합 평가
- **신뢰도 등급**: HIGH(두 경로 발견) / MEDIUM(단일 경로) 제공
- **실시간 프로세스 로깅**: 모든 검색 과정의 투명한 공개

### 6. **HS 해설서 원문 검색** 📖
- 특정 HS 코드의 해설서 원문을 구조화된 형태로 제공
- 통칙, 부/류/호 해설을 체계적으로 정리하여 표시

## 🚀 설치 및 실행

### 필수 요구사항
```bash
pip install -r requirements.txt
```

**또는 개별 설치:**
```bash
pip install google-genai
pip install python-dotenv
pip install streamlit
pip install typing-extensions
pip install numpy
pip install pandas
pip install requests
```

### 환경 설정
1. `.env` 파일 생성:
```env
GOOGLE_API_KEY=your_google_api_key_here
```

2. 필요한 데이터 파일들을 `knowledge/` 폴더에 배치:
   - `HS분류사례_part1.json` ~ `HS분류사례_part10.json` (국내 분류사례)
   - `HS위원회.json`, `HS협의회.json` (위원회/협의회 결정)
   - `hs_classification_data_us.json` (미국 관세청 데이터)
   - `hs_classification_data_eu.json` (EU 관세청 데이터)
   - `hstable.json` (관세율표 - 병렬검색용)
   - `통칙_grouped.json` (HS 통칙)
   - `grouped_11_end.json` (HS 해설서)

### 실행
```bash
streamlit run main.py
```

## 📖 기능별 사용법

### 1. AI 자동분류 사용법
**사용 시점**: 어떤 유형의 질문인지 확실하지 않을 때

**예시 질문**:
```
"리튬이온 배터리의 HS 코드가 무엇인가요?"
→ AI가 자동으로 'HS 분류사례 검색'으로 분류하여 답변

"전기차 시장 동향이 궁금합니다"
→ AI가 자동으로 '웹 검색'으로 분류하여 최신 정보 제공
```

**장점**: 
- 질문 유형을 고민할 필요 없음
- 가장 적합한 방식으로 자동 처리

### 2. 웹 검색 사용법
**사용 시점**: 최신 시장 정보, 뉴스, 동향이 필요할 때

**예시 질문**:
```
"2024년 반도체 수출 동향"
"친환경 포장재 시장 현황"
"최근 K-뷰티 제품 해외 진출 동향"
"전기차 배터리 기술 발전 현황"
```

**답변 예시**:
```
+++ 웹검색 실시 +++

2024년 반도체 수출 동향에 대한 최신 정보입니다:

1. 수출 실적
- 2024년 반도체 수출액은 전년 대비 15% 증가
- 메모리 반도체가 전체 수출의 60% 차지

2. 주요 수출국
- 중국 35%, 미국 20%, 일본 15%
- 동남아시아 지역으로의 수출 확대 추세

3. 시장 전망
- AI 반도체 수요 급증으로 지속적 성장 예상
```

### 3. 국내 HS 분류사례 검색 사용법
**사용 시점**: 한국 관세청의 공식 분류 사례가 필요할 때

**예시 질문**:
```
"프로틴 파우더의 HS 코드는?"
"무선 이어폰 HS 분류"
"LED 조명의 품목분류"
"화장품용 세럼 HS 코드"
```

**답변 예시**:
```
+++ HS 분류사례 검색 실시 +++

프로틴 파우더의 HS 분류 분석 결과:

【추천 HS 코드】: 2106.90-9090
【품목 설명】: 기타 조제식료품

【분류 근거】:
1. 관세청 사례 분석
   - 유사 사례: "단백질 보충제 분말" → 2106.90-9090 분류
   - 분류 사유: 단백질 함량이 높은 조제식료품으로 분류

2. 성분 및 용도 고려사항
   - 주성분: 유청단백질, 카제인 등
   - 용도: 운동 후 근육 회복 및 단백질 보충
   - 형태: 분말 형태의 즉석 용해 제품

【관세율】: 기본세율 8%, 협정세율 적용 시 0-5%
【주의사항】: 의약품 성분 함유 시 별도 분류 검토 필요
```

### 4. 해외 HS 분류사례 검색 사용법
**사용 시점**: 미국/EU 관세청 분류 사례나 국제적 동향이 필요할 때

**예시 질문**:
```
"미국에서 전자담배 HS 분류는?"
"EU의 친환경 포장재 HS 코드"
"해외 CBD 오일 품목분류 동향"
"미국 관세청의 스마트워치 분류 사례"
```

**답변 예시**:
```
+++ 해외 HS 분류 검색 실시 +++

미국에서의 전자담배 HS 분류 분석:

【미국 관세청 분류】
- HS 코드: 8543.70-9860
- 분류명: Electronic cigarettes and similar personal electric vaporizing devices

【EU 관세청 분류】
- HS 코드: 8543.70-9000
- 분류명: Electrical machines having individual functions

【국제적 분류 동향】
1. 미국: 전자담배를 전자기기로 분류, 니코틴 함유량에 따라 추가 규제
2. EU: 의료기기 규정과 연계하여 엄격한 분류 기준 적용
3. 캐나다: 담배 대체품으로 분류하여 높은 세율 적용

【한국 분류와의 비교】
- 한국: 8543.70-9000 (기타 전기기기)
- 국제적으로 유사한 분류 체계 유지
```

### 5. HS 해설서 분석 사용법 (병렬 검색)
**사용 시점**: HS 해설서 내용을 바탕으로 한 심층 분석이 필요할 때

**🔄 병렬 검색 프로세스**:
1. **경로 1**: 관세율표에서 유사도 기반 HS코드 후보 선정
2. **경로 2**: 해설서에서 직접 검색 (기존 Multi-Agent 방식)
3. **결과 통합**: 가중치 기반 최종 순위 결정

**예시 질문**:
```
"스마트폰의 HS 분류"
"리튬이온 배터리 품목분류"  
"LED 조명 HS 코드"
"화장품용 세럼 분류 기준"
```

**답변 예시**:
```
+++ HS 해설서 분석 실시 (병렬 검색) +++

스마트폰의 HS 분류 분석 결과:

【최적 HS 코드】: 8517.12-1000
【신뢰도】: HIGH (두 검색 경로 모두 일치)

【병렬 검색 결과】
1. 관세율표 기반 (신뢰도: 0.89)
   - 품목명: "전화기(셀룰러 네트워크용)"
   - 유사도 점수: 0.92

2. 해설서 기반 (다중 그룹 검색)
   - 그룹 1-3: 8517호 관련 사례 발견
   - 분류 근거: 무선통신 기능 중심

【종합 분류 근거】
- 관세율표: 직접적 품목명 매칭
- 해설서: 무선통신기기 분류 기준 적합
- 통신 기능이 주요 용도로 8517호 적용

【추가 고려사항】
- 카메라 기능은 부차적 기능으로 분류에 영향 없음
- 컴퓨팅 기능보다 통신 기능이 우선
```

**🔍 실시간 로깅 예시**:
```
15:23:45.123 +0.05s 🔍 Path 1: Tariff Table → Manual search starting...
15:23:45.445 +0.37s 📊 Tariff table search completed | 12 candidates in 0.22s
15:23:45.667 +0.54s 🔍 Path 2: Direct manual search starting...
15:23:47.234 +2.16s 🤖 Consolidating parallel search results...
15:23:47.891 +2.83s ✅ Results consolidation completed | 5 unique HS codes
```

### 6. HS 해설서 원문 검색 사용법
**사용 시점**: 특정 HS 코드의 공식 해설서 원문이 필요할 때

**예시 질문**:
```
"8517"
"HS 2106"
"1234"
"HS1005"
```

**답변 예시**:
```
+++ HS 해설서 원문 검색 실시 +++

# HS 코드 8517 해설

## 📋 해설서 통칙

### 통칙 1
분류는 우선 류와 호의 용어에 따라 결정하고...

### 통칙 2
(a) 완성되지 않은 물품에 대한 언급은...

## 📂 부(部) 해설

제16부 - 기계류, 전기기기와 그 부분품
이 부에는 일반적으로 기계류, 기구, 장치 및 전기기기...

## 📚 류(類) 해설

제85류 - 전기기기와 그 부분품
이 류에는 전기를 발생, 변환, 분배 또는 사용하는 기계와 기구...

## 📝 호(號) 해설

8517호 - 전화기, 기타 음성·영상·기타 자료의 송신용·수신용 기기
이 호에는 전화기와 기타 통신기기가 포함됩니다...

1. 유선전화기
2. 무선전화기 
3. 팩시밀리
4. 텔렉스 단말기
...
```

## 🏗️ 프로젝트 구조

```
HS_Chatbot/
├── main.py                 # Streamlit 메인 애플리케이션 (실시간 로깅 포함)
├── utils.py                # 핵심 기능 및 병렬 검색 시스템
├── hs_search.py            # HS 코드 검색 유틸리티
├── CLAUDE.md              # Claude Code 개발 가이드
├── .env                    # 환경 변수 (API 키)
├── requirements.txt        # 패키지 의존성 목록
├── README.md              # 프로젝트 문서
├── knowledge/             # 핵심 데이터 파일
│   ├── HS분류사례_part1.json ~ part10.json  # 국내 분류사례
│   ├── HS위원회.json, HS협의회.json          # 위원회 결정사항
│   ├── hs_classification_data_us.json       # 미국 관세청 데이터
│   ├── hs_classification_data_eu.json       # EU 관세청 데이터
│   ├── hstable.json                         # 관세율표 (병렬검색)
│   ├── 통칙_grouped.json                     # HS 통칙
│   └── grouped_11_end.json                  # HS 해설서
├── 품목분류표_제작/        # 관세율표 데이터 처리
└── previously/            # 이전 버전 백업
```

## ⚙️ 환경 설정

### 1. Google API 키 발급
1. [Google AI Studio](https://makersuite.google.com/app/apikey) 접속
2. API 키 생성
3. `.env` 파일에 추가

### 2. 데이터 준비
- 관세청 공식 HS 분류 사례 데이터
- 해외 관세청 분류 데이터
- HS 해설서 및 통칙 데이터

### 3. 성능 최적화 및 고급 기능
- **Streamlit 캐싱**: `@st.cache_resource`로 HSDataManager 최적화
- **Multi Agents 시스템**: 대용량 데이터를 5개 그룹으로 병렬 처리
- **병렬 검색 엔진**: 관세율표 + 해설서 동시 검색으로 정확도 향상
- **실시간 로깅**: 모든 AI 처리 과정의 투명한 시각화
- **유사도 기반 매칭**: SequenceMatcher를 활용한 정밀 텍스트 매칭
- **가중치 기반 통합**: 다중 소스 결과의 지능적 결합

## 🤝 기여하기

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📄 라이선스

이 프로젝트는 MIT 라이선스를 따릅니다.

## 📞 문의

프로젝트에 대한 문의사항이나 개선 제안이 있으시면 이슈를 생성해 주세요.

---

**Made with ❤️ for HS Classification Professionals**
